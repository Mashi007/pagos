[1mdiff --git a/ESQUEMA_COMPARACION.md b/ESQUEMA_COMPARACION.md[m
[1mnew file mode 100644[m
[1mindex 0000000..258e69b[m
[1m--- /dev/null[m
[1m+++ b/ESQUEMA_COMPARACION.md[m
[36m@@ -0,0 +1,160 @@[m
[32m+[m[32m# üìä An√°lisis de Esquema de Base de Datos[m
[32m+[m
[32m+[m[32m## üéØ Resumen Ejecutivo[m
[32m+[m
[32m+[m[32mHe revisado exhaustivamente todos los modelos de la base de datos y los he comparado con el esquema proporcionado. **Se identificaron y corrigieron problemas cr√≠ticos** que podr√≠an estar contribuyendo a los errores de conexi√≥n.[m
[32m+[m
[32m+[m[32m## ‚ùå Problemas Cr√≠ticos Identificados y Corregidos[m
[32m+[m
[32m+[m[32m### 1. üö® **Inconsistencia en Relaciones Cliente-Pr√©stamo** (CR√çTICO)[m
[32m+[m
[32m+[m[32m**PROBLEMA**: El modelo `Prestamo` referenciaba incorrectamente a `users.id` en lugar de `clientes.id`[m
[32m+[m
[32m+[m[32m```python[m
[32m+[m[32m# ‚ùå ANTES (INCORRECTO):[m
[32m+[m[32mcliente_id = Column(Integer, ForeignKey("users.id"), nullable=False)[m
[32m+[m
[32m+[m[32m# ‚úÖ DESPU√âS (CORREGIDO):[m
[32m+[m[32mcliente_id = Column(Integer, ForeignKey("clientes.id"), nullable=False)[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m**IMPACTO**: Esta inconsistencia podr√≠a causar errores de integridad referencial y problemas de conexi√≥n.[m
[32m+[m
[32m+[m[32m### 2. üö® **Tablas Faltantes**[m
[32m+[m
[32m+[m[32m#### Tabla `CONCILIACION` - ‚úÖ **CREADA**[m
[32m+[m[32m```sql[m
[32m+[m[32mCREATE TABLE conciliacion ([m
[32m+[m[32m    id INTEGER PRIMARY KEY,[m
[32m+[m[32m    pago_id INTEGER REFERENCES pagos(id) ON DELETE CASCADE,[m
[32m+[m[32m    fecha_carga TIMESTAMP WITH TIME ZONE,[m
[32m+[m[32m    ref_bancaria VARCHAR(100),[m
[32m+[m[32m    monto_banco NUMERIC(12,2),[m
[32m+[m[32m    estado_match VARCHAR(20) DEFAULT 'PENDIENTE',[m
[32m+[m[32m    usuario_id INTEGER REFERENCES users(id) ON DELETE SET NULL,[m
[32m+[m[32m    observaciones TEXT,[m
[32m+[m[32m    tipo_match VARCHAR(20),[m
[32m+[m[32m    confianza_match NUMERIC(5,2),[m
[32m+[m[32m    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()[m
[32m+[m[32m);[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### Tabla `CONFIGURACION` - ‚úÖ **CREADA**[m
[32m+[m[32m```sql[m
[32m+[m[32mCREATE TABLE configuracion ([m
[32m+[m[32m    id INTEGER PRIMARY KEY,[m
[32m+[m[32m    clave VARCHAR(100) UNIQUE NOT NULL,[m
[32m+[m[32m    valor JSON NOT NULL,[m
[32m+[m[32m    tipo VARCHAR(50) NOT NULL,[m
[32m+[m[32m    descripcion TEXT,[m
[32m+[m[32m    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),[m
[32m+[m[32m    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()[m
[32m+[m[32m);[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### 3. üîß **Campos Faltantes en CLIENTES** - ‚úÖ **AGREGADOS**[m
[32m+[m
[32m+[m[32mSe agregaron todos los campos espec√≠ficos de tu esquema:[m
[32m+[m
[32m+[m[32m```sql[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN estado_caso VARCHAR(50);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN modelo_vehiculo VARCHAR(100);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN analista_id INTEGER REFERENCES users(id);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN concesionario VARCHAR(100);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN fecha_pago_ini DATE;[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN total_financia NUMERIC(12,2);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN cuota_inicial NUMERIC(12,2);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN fecha_entrega DATE;[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN amortizaciones INTEGER;[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN modalidad_finan VARCHAR(20);[m
[32m+[m[32mALTER TABLE clientes ADD COLUMN requiere_actual BOOLEAN DEFAULT FALSE;[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m## ‚úÖ Estado Final del Esquema[m
[32m+[m
[32m+[m[32m### **Tablas Implementadas y Verificadas:**[m
[32m+[m
[32m+[m[32m| **Tabla** | **Estado** | **Campos Clave** | **Relaciones** |[m
[32m+[m[32m|-----------|------------|------------------|----------------|[m
[32m+[m[32m| **users** | ‚úÖ Completa | id, email, rol, is_active | ‚Üí aprobaciones, auditorias |[m
[32m+[m[32m| **clientes** | ‚úÖ Actualizada | cedula, nombres, analista_id, estado_caso | ‚Üí prestamos, notificaciones |[m
[32m+[m[32m| **prestamos** | ‚úÖ Corregida | cliente_id (FK), monto_total, estado | ‚Üí cuotas, pagos |[m
[32m+[m[32m| **cuotas** | ‚úÖ Completa | prestamo_id (FK), numero_cuota, estado | ‚Üí pagos (M2M) |[m
[32m+[m[32m| **pagos** | ‚úÖ Completa | prestamo_id (FK), monto_pagado, estado | ‚Üí conciliacion |[m
[32m+[m[32m| **aprobaciones** | ‚úÖ Completa | solicitante_id, revisor_id, estado | ‚Üí users |[m
[32m+[m[32m| **conciliacion** | ‚úÖ **NUEVA** | pago_id (FK), ref_bancaria, estado_match | ‚Üí pagos, users |[m
[32m+[m[32m| **notificaciones** | ‚úÖ Completa | cliente_id (FK), tipo, estado | ‚Üí clientes, users |[m
[32m+[m[32m| **auditorias** | ‚úÖ Completa | usuario_id (FK), accion, tabla | ‚Üí users |[m
[32m+[m[32m| **configuracion** | ‚úÖ **NUEVA** | clave (UNIQUE), valor (JSON), tipo | Standalone |[m
[32m+[m
[32m+[m[32m### **üîó Relaciones Verificadas:**[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mUSERS (1) ‚Üê‚Üí (N) APROBACIONES (solicitante/revisor)[m
[32m+[m[32mUSERS (1) ‚Üê‚Üí (N) CLIENTES (analista asignado)[m
[32m+[m[32mUSERS (1) ‚Üê‚Üí (N) AUDITORIAS[m
[32m+[m[32mUSERS (1) ‚Üê‚Üí (N) CONCILIACION[m
[32m+[m
[32m+[m[32mCLIENTES (1) ‚Üê‚Üí (N) PRESTAMOS[m
[32m+[m[32mCLIENTES (1) ‚Üê‚Üí (N) NOTIFICACIONES[m
[32m+[m
[32m+[m[32mPRESTAMOS (1) ‚Üê‚Üí (N) CUOTAS[m
[32m+[m[32mPRESTAMOS (1) ‚Üê‚Üí (N) PAGOS[m
[32m+[m
[32m+[m[32mPAGOS (1) ‚Üê‚Üí (1) CONCILIACION[m
[32m+[m[32mPAGOS (M) ‚Üê‚Üí (N) CUOTAS (tabla intermedia)[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m## üöÄ Migraci√≥n Creada[m
[32m+[m
[32m+[m[32mSe cre√≥ el archivo de migraci√≥n: `backend/alembic/versions/001_actualizar_esquema_er.py`[m
[32m+[m
[32m+[m[32m### **Para Aplicar la Migraci√≥n:**[m
[32m+[m
[32m+[m[32m```bash[m
[32m+[m[32m# En desarrollo local:[m
[32m+[m[32mcd backend[m
[32m+[m[32malembic upgrade head[m
[32m+[m
[32m+[m[32m# En Render (autom√°tico al deploy):[m
[32m+[m[32m# La migraci√≥n se aplicar√° autom√°ticamente[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m## üéØ Impacto en el Problema de Conexi√≥n[m
[32m+[m
[32m+[m[32m### **Posibles Causas del Error DNS Resueltas:**[m
[32m+[m
[32m+[m[32m1. **‚úÖ Inconsistencias de FK**: Las referencias incorrectas podr√≠an causar errores de integridad[m
[32m+[m[32m2. **‚úÖ Modelos incompletos**: Los campos faltantes podr√≠an generar errores de SQL[m
[32m+[m[32m3. **‚úÖ Relaciones rotas**: Las relaciones incorrectas podr√≠an causar fallos en queries[m
[32m+[m
[32m+[m[32m### **‚ö†Ô∏è El Problema Principal Persiste**[m
[32m+[m
[32m+[m[32mEl error DNS `could not translate host name "dpg-d318tkuz433a730ouph0-a"` **sigue siendo un problema de configuraci√≥n en Render**, pero ahora el esquema est√° correcto y no deber√≠a generar errores adicionales.[m
[32m+[m
[32m+[m[32m## üìã Pr√≥ximos Pasos Recomendados[m
[32m+[m
[32m+[m[32m1. **üîÑ Deploy con Esquema Corregido**:[m
[32m+[m[32m   - Hacer commit de los cambios[m
[32m+[m[32m   - Push al repositorio[m
[32m+[m[32m   - Render har√° deploy autom√°tico con el esquema corregido[m
[32m+[m
[32m+[m[32m2. **üîß Configurar DATABASE_URL en Render**:[m
[32m+[m[32m   - Dashboard de Render ‚Üí PostgreSQL Database[m
[32m+[m[32m   - Copiar URL interna correcta[m
[32m+[m[32m   - Actualizar variable en Web Service[m
[32m+[m
[32m+[m[32m3. **‚úÖ Verificar Funcionamiento**:[m
[32m+[m[32m   - Monitorear logs de deploy[m
[32m+[m[32m   - Probar endpoints: `/health/full`, `/docs`[m
[32m+[m[32m   - Verificar que las tablas se crean correctamente[m
[32m+[m
[32m+[m[32m## üéâ Beneficios de las Correcciones[m
[32m+[m
[32m+[m[32m- **üîß Esquema consi